<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Optional styles and scripts of your own -->
    <link type="text/css" href="styles/my_style.css">

    <!-- Bootstrap FirebaseUI CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>

    <!-- Link to the api keys for your firebase project -->
    <script src="/scripts/firebaseAPI.js"></script>


    <style>
        .nav-item {
            color: purple;
        }

        .logo {
            width: 120px;
            height: 120px;
            border-radius: 75px;
            background-image: url(images/cube_logo.png);
            background-position: center;
            background-size: 110px;
            justify-self: center;
            align-self: center;
        }

        #postButton {
            margin-left: 65%;
        }

        @media only screen and (max-width: 400px) {
            #postButton {
                float: right;
            }

        }
    </style>
</head>

<body>

    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
        </script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
        </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
        </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
        </script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-success">
        <div class="container-fluid">
            <a class="navbar-brand">
                <div class="logo">
                </div>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="main.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Saved</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Navigate</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="govt_update.html">Updates</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="login.html">Sign out</a>
                    </li>
                </ul>

                <!-- Button trigger modal -->
                <div id="postButton">
                    <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#exampleModal"
                        onclick="saveUserInfo()">
                        Post
                    </button>
                </div>

            </div>
        </div>
    </nav>

    <br>

    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Make a post</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="container">
                            <h1>User Profile </h1>
                            <form>
                                <fieldset class="mb-3" id="personalInfoFields" disabled>
                                    <div class="form-group">
                                        <label>Name</label>
                                        <input type="text" id="nameInput" class="form-control"
                                            placeholder="Enter your name">
                                    </div>
                                    <div class="form-group">
                                        <label>Title</label>
                                        <input type="text" id="titleInput" class="form-control"
                                            placeholder="Enter the title">
                                    </div>
                                    <div class="form-group">
                                        <label>Story</label>
                                        <input type="text" id="storyInput" class="form-control"
                                            placeholder="Enter your story">
                                    </div>
                                </fieldset>
                                <div class="d-flex justify-content-end mt-5">
                                    <button type="button" class="btn btn-secondary"
                                        onclick="editUserInfo()">Edit</button>
                                    <span style="width: 10px"></span>
                                    <button type="button" class="btn btn-info">Post</button>
                                </div>
                            </form>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Banner -->
    <div class="container-fluid bg-dark text-light p-5">
        <div class="container bg-dark p-5">
            <h1 class="display-4">Welcome, <span id="name-goes-here"></span></h1>
            <hr>
        </div>
    </div>

    <!-- Covid Story 1 -->
    <nav class="navbar navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                Covid story 1
                <br>
                <img src="images/covidstory1.jpg" alt="" width="400" height="300" class="d-inline-block align-text-top">
            </a>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                Suspendisse rhoncus lacus eget interdum ullamcorper.
                In a bibendum enim, a convallis lorem. Suspendisse potenti.
                Integer rutrum ex quam, eu suscipit odio sollicitudin a.
                Nunc posuere nibh ullamcorper tortor dapibus, et bibendum nisl vehicula.
                Sed gravida nisl et urna sollicitudin, eget pulvinar metus efficitur.
                In libero est, tempor et libero at, ultrices laoreet magna.
                Donec blandit ipsum non urna porta maximus.
            </p>
        </div>
    </nav>

    <br>

    <!-- Covid Story 2 -->
    <nav class="navbar navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                Covid story 2
                <br>
                <img src="images/covidstory2.jpg" alt="" width="400" height="300" class="d-inline-block align-text-top">
            </a>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                Suspendisse rhoncus lacus eget interdum ullamcorper.
                In a bibendum enim, a convallis lorem. Suspendisse potenti.
                Integer rutrum ex quam, eu suscipit odio sollicitudin a.
                Nunc posuere nibh ullamcorper tortor dapibus, et bibendum nisl vehicula.
                Sed gravida nisl et urna sollicitudin, eget pulvinar metus efficitur.
                In libero est, tempor et libero at, ultrices laoreet magna.
                Donec blandit ipsum non urna porta maximus.
            </p>
        </div>
    </nav>

    <!-- Covid Story 3 -->
    <nav class="navbar navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="postpage.html">
                Covid story 3
                <br>
                <img src="images/covidstory3.jpg" alt="" width="400" height="300" class="d-inline-block align-text-top">
            </a>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                Suspendisse rhoncus lacus eget interdum ullamcorper.
                In a bibendum enim, a convallis lorem. Suspendisse potenti.
                Integer rutrum ex quam, eu suscipit odio sollicitudin a.
                Nunc posuere nibh ullamcorper tortor dapibus, et bibendum nisl vehicula.
                Sed gravida nisl et urna sollicitudin, eget pulvinar metus efficitur.
                In libero est, tempor et libero at, ultrices laoreet magna.
                Donec blandit ipsum non urna porta maximus.
            </p>
        </div>
    </nav>

    <!-- Sticky Footer -->
    <footer class="navbar justify-content-evenly fixed-bottom">
        <small>DTC 16</small>
    </footer>

    <!-- Scripts -->

    <script>
        var currentUser
        //read_display_Quote()

        function insertName() {
            firebase.auth().onAuthStateChanged(user => {
                // Check if user is signed in:
                if (user) {
                    // Do something for the current logged-in user here: 
                    //console.log(user.uid);
                    //go to the correct user document by referencing to the user uid
                    currentUser = db.collection("users").doc(user.uid)
                    //get the document for current user.
                    currentUser.get()
                        .then(userDoc => {
                            var user_Name = userDoc.data().name;
                            //console.log(user_Name);
                            //document.getElementById("username").innerText = n;                     //using javascript
                            $("#name-goes-here").text(user_Name); //using jquery
                        })
                } else {
                    // No user is signed in.
                }
            });
        }
        insertName();

        function populateInfo() {
            firebase.auth().onAuthStateChanged(user => {
                // Check if user is signed in:
                if (user) {

                    //go to the correct user document by referencing to the user uid
                    currentUser = db.collection("users").doc(user.uid)
                    //get the document for current user.
                    currentUser.get()
                        .then(userDoc => {
                            //get the data fields of the user
                            var userName = userDoc.data().name;
                            var userTitle = userDoc.data().title
                            var userStory = userDoc.data().story;

                            //if the data fields are not empty, then write them in to the form.
                            if (userName != null) {
                                document.getElementById("nameInput").value = userName;
                            }
                            if (userTitle != null) {
                                document.getElementById("titleInput").value = userTitle;
                            }
                            if (userStory != null) {
                                document.getElementById("storyInput").value = userStory;
                            }
                        })
                } else {
                    // No user is signed in.
                    console.log("No user is signed in");
                }
            });
        }

        //call the function to run it 
        populateInfo();

        function editUserInfo() {
            //Enable the form fields
            document.getElementById('personalInfoFields').disabled = false;
        }

        function saveUserInfo() {
            userName = document.getElementById('nameInput').value;       //get the value of the field with id="nameInput"
            userTitle = document.getElementById('titleInput').value;     //get the value of the field with id="titleInput"
            userStory = document.getElementById('storyInput').value;       //get the value of the field with id="storyInput"
        }

        currentUser.update({
            name: userName,
            title: userTitle,
            story: userStory
        })
            .then(() => {
                console.log("Document successfully updated!");
            })

        document.getElementById('personalInfoFields').disabled = true;

        function editUserInfo() {
            //Enable the form fields
            document.getElementById('personalInfoFields').disabled = false;
        }

    </script>

</body>


</html>