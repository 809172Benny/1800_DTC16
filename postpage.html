<!doctype html>
<html lang="en">

<head>
    <!-- Bootstrap FirebaseUI CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>

    <!-- Link to the api keys for your firebase project -->
    <script src="./scripts/firebaseAPI.js"></script>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.88.1">
    <title>DTC 16 Covid Story 1</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
    </script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous">
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
    </script>

    <!-- Google Icons (Material Design)-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="signin.css" rel="stylesheet">

    <!-- Google Icons (Material Design)-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        body {
            background-color: #eee
        }

        .comments {
            text-decoration: underline;
            text-underline-position: under;
            cursor: pointer
        }

        .hit-voting:hover {
            color: blue
        }

        .hit-voting {
            cursor: pointer
        }


        .logo {
            width: 120px;
            height: 120px;
            border-radius: 75px;
            background-image: url(images/cube_logo.png);
            background-position: center;
            background-size: 110px;
            justify-self: center;
            align-self: center;
        }

        .navbar {
            background-image: linear-gradient(to right, rgb(247, 156, 46), rgb(128, 0, 128));
        }
    </style>
</head>

<body>

    <!-- Navigation Bar -->
    <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-success">
        <div class="container-fluid">
            <a class="navbar-brand">
                <div class="logo">
                </div>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="main.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Saved</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#">Navigate</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="govt_update.html">Updates</a>
                    </li>
                    <li class="nav-item" id="signout_button">
                        <a class="nav-link" href="login.html">Sign out</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Navigation Bar ends-->

    <br>
    <br>
    <br>
    <br>

    <div class="container mt-5 mb-5">
        <div class="d-flex justify-content-center row">
            <div class="d-flex flex-column col-md-8">
                <div class="d-flex flex-row align-items-center text-left comment-top p-2 bg-white border-bottom px-4">
                    <div class="profile-image"><img class="rounded-circle" src="images/generic_steve.jpg" width="70">
                    </div>
                    <div class="d-flex flex-column-reverse flex-grow-0 align-items-center votings ml-1"><i
                            class="fa fa-sort-up fa-2x hit-voting"></i><span></span><i
                            class="fa fa-sort-down fa-2x hit-voting"></i></div>
                    <div class="d-flex flex-column ml-3">
                        <div class="d-flex flex-row post-title">
                            <h5>Comments</h5><span class="ml-2"></span>
                        </div>
                        <div class="d-flex flex-row align-items-center align-content-center post-title"><span
                                class="mr-2 comments">3 comments&nbsp;</span><span></span></div>
                    </div>
                </div>
                <div class="coment-bottom bg-white p-2 px-4">


                    <!-- Modal Button-->
                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
                        Add a comment
                    </button>

                    <!-- Modal -->
                    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Add a comment</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <input type="text" id="commentInput" class="form-control">
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" onclick="saveCommentInfo()">Post
                                        Comment</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal Button-->

                    <!---Comment Card-->

                    <div class="card">
                        <div class="card-header">
                        </div>
                        <div class="card-body">
                            <h5 class="userName">Username Goes here</h5>
                            <p class="comment-details">Comments go here</p>

                            <!-- Reply Modal button-->

                            <button type="button" class="btn btn-primary" data-bs-toggle="modal"
                                data-bs-target="#replyModal"> Reply </button>
                        </div>
                    </div>

                    <!-- Reply Modal Functionality-->

                    <div class="modal fade" id="replyModal" tabindex="-1" aria-labelledby="replyModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="replyModalLabel">Add a Reply</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <input type="text" id="replyInput" class="form-control">
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary"
                                        data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" onclick="saveReplyInfo()">Post
                                        reply</button>
                                </div>
                            </div>
                        </div>
                    </div>




<script>
var currentUserName = undefined;

function getCurrentUserUid() {
    currentUser = firebase.auth().currentUser;
    if (currentUser != null) {
        console.log(currentUser.uid);
        return currentUser.uid;
    }
    return null;
}

function populateInfoComments() {
    firebase.auth().onAuthStateChanged(user => {
        if (user) {
            var currentUser = db.collection("users").doc(user.uid)
            currentUser.get()
                .then(userDoc => {

                    var userComment = userDoc.data().comment;

                    if (userComment !== null) {
                        document.getElementById('commentInput').value = userComment;
                    }
                })
        } else {
            console.log("No user is signed in");
        }
    });
}
populateInfoComments();


function saveCommentInfo() {
    userComment = document.getElementById("commentInput").value;
    console.log(userComment);
    firebase.auth().onAuthStateChanged(user => {
            if (user) {
                var currentUser = db.collection("users").doc(user.uid);
                


                db.collection("Comments").add({
                        comment: userComment
                    })
                    .then(() => {
                        console.log("Comment successfully updated.")
                    });
            }
        });
    }
    //populating the comment post
console.log('loaded')
    function insertComment() {
        firebase.auth().onAuthStateChanged(user => {
            // Check if user is signed in:
            if (user) {
                // Do something for the current logged-in user here: 
                console.log(user.uid);
                //go to the correct user document by referencing to the user uid
                currentUser = db.collection("Comments").doc(user.uid);
                //get the document for current user.
                currentUser.get()
                    .then(userDoc => {
                        var user_Comment = userDoc.data().comment;
                        console.log(user_Comment);
                        //method #1:  insert with html only
                        //document.getElementById("name-goes-here").innerText = n;    //using javascript
                        //method #2:  insert using jquery
                        $("#comment-goes-here").text(
                            user_Comment); //using jquery
                    })
            } else {
                // No user is signed in.
            }
        });
    }
    insertComment();


    //Reply button functionality

    function replybutton(btn) {
        btn.nextElementSibling.style.display = "block";
        btn.style.display = "none"
    }

    function populateReplyComments() {
        firebase.auth().onAuthStateChanged(user => {
            if (user) {

                currentUser = db.collection("users").doc(user.uid)

                currentUser.get()
                    .then(userDoc => {

                        var userReply = userDoc.data().reply;

                        if (userReply != null) {
                            document.getElementById('replyInput').value =
                                userReply;
                        }
                    })
            } else {
                console.log("No user is signed in");
            }
        });
    }
    populateReplyComments();

    var currentUser

    function savereplyinfo() {
        userReply = document.getElementById("replyInput").value;
        console.log(userReply);

        db.collection("replies").add({
                reply: userReply
            })
            .then(() => {
                console.log("Reply successfully updated.")
            })
    }        
</script>









</body>



<footer class="navbar justify-content-evenly fixed-bottom">
    <small>Copyright, DTC 16 2021</small>
</footer>

</html>